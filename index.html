import React, { useState, useEffect } from 'react';
import './App.css';

// Mock data for demonstration
const mockPatientData = {
  name: "Sarah Johnson",
  age: 52,
  gender: "Female",
  email: "sarah.johnson@example.com",
  phone: "+1 (555) 123-4567",
  address: "123 Healthcare Ave, Boston, MA",
  emergencyContact: "Michael Johnson - +1 (555) 987-6543",
  conditions: ["Diabetes", "Hypertension"],
  profileImage: null
};

const mockHealthData = {
  bloodPressure: { systolic: 128, diastolic: 82 },
  bloodSugar: { fasting: 105, postPrandial: 140 },
  weight: 68,
  height: 165
};

const mockReports = [
  { id: 1, name: "Blood Test", date: "2023-10-15", type: "Diabetes", fileType: "PDF" },
  { id: 2, name: "Lipid Profile", date: "2023-09-22", type: "General", fileType: "PDF" },
  { id: 3, name: "Thyroid Function", date: "2023-08-10", type: "Thyroid", fileType: "JPG" }
];

const mockReminders = [
  { id: 1, title: "Take Metformin", time: "08:00 AM", completed: true },
  { id: 2, title: "Blood Pressure Check", time: "12:00 PM", completed: false },
  { id: 3, title: "Evening Walk", time: "06:00 PM", completed: false }
];

function App() {
  const [activeTab, setActiveTab] = useState('home');
  const [patientData, setPatientData] = useState(mockPatientData);
  const [healthData, setHealthData] = useState(mockHealthData);
  const [reports, setReports] = useState(mockReports);
  const [reminders, setReminders] = useState(mockReminders);
  const [selectedDisease, setSelectedDisease] = useState('diabetes');
  const [chatMessages, setChatMessages] = useState([
    { id: 1, text: "Hello! I'm your ChronicCare+ assistant. How can I help you today?", sender: "ai" }
  ]);
  const [newMessage, setNewMessage] = useState('');

  // Handle file upload
  const handleFileUpload = (e) => {
    const file = e.target.files[0];
    if (file) {
      alert(`File "${file.name}" uploaded successfully!`);
      // In a real app, you would upload to your backend here
    }
  };

  // Handle chat message submission
  const handleSendMessage = () => {
    if (newMessage.trim() === '') return;
    
    const userMessage = { id: chatMessages.length + 1, text: newMessage, sender: "user" };
    setChatMessages([...chatMessages, userMessage]);
    
    // Simulate AI response
    setTimeout(() => {
      const aiMessage = { 
        id: chatMessages.length + 2, 
        text: "I understand your concern. Based on your health data, I recommend discussing this with your doctor during your next appointment.", 
        sender: "ai" 
      };
      setChatMessages(prev => [...prev, aiMessage]);
    }, 1000);
    
    setNewMessage('');
  };

  // Toggle reminder completion
  const toggleReminder = (id) => {
    setReminders(reminders.map(reminder => 
      reminder.id === id ? { ...reminder, completed: !reminder.completed } : reminder
    ));
  };

  return (
    <div className="app">
      {/* Header */}
      <header className="app-header">
        <div className="header-content">
          <div className="logo">
            <h1>ChronicCare+</h1>
            <span>Your Health Companion</span>
          </div>
          <div className="user-info">
            <div className="user-avatar">
              {patientData.profileImage ? (
                <img src={patientData.profileImage} alt="Profile" />
              ) : (
                <div className="avatar-placeholder">
                  {patientData.name.charAt(0)}
                </div>
              )}
            </div>
            <span className="user-name">{patientData.name}</span>
          </div>
        </div>
      </header>

      {/* Main Content */}
      <main className="main-content">
        {activeTab === 'home' && <HomeDashboard 
          healthData={healthData} 
          reminders={reminders}
          toggleReminder={toggleReminder}
          patientData={patientData}
        />}
        
        {activeTab === 'reports' && <ReportsSection 
          reports={reports}
          handleFileUpload={handleFileUpload}
        />}
        
        {activeTab === 'disease' && <DiseaseTracker 
          selectedDisease={selectedDisease}
          setSelectedDisease={setSelectedDisease}
        />}
        
        {activeTab === 'profile' && <ProfileSection 
          patientData={patientData}
          setPatientData={setPatientData}
        />}
        
        {activeTab === 'chat' && <ChatSection 
          chatMessages={chatMessages}
          newMessage={newMessage}
          setNewMessage={setNewMessage}
          handleSendMessage={handleSendMessage}
        />}
      </main>

      {/* Bottom Navigation */}
      <nav className="bottom-nav">
        <button 
          className={`nav-item ${activeTab === 'home' ? 'active' : ''}`}
          onClick={() => setActiveTab('home')}
        >
          <i className="fas fa-home"></i>
          <span>Home</span>
        </button>
        
        <button 
          className={`nav-item ${activeTab === 'reports' ? 'active' : ''}`}
          onClick={() => setActiveTab('reports')}
        >
          <i className="fas fa-file-medical"></i>
          <span>Reports</span>
        </button>
        
        <button 
          className={`nav-item ${activeTab === 'disease' ? 'active' : ''}`}
          onClick={() => setActiveTab('disease')}
        >
          <i className="fas fa-heartbeat"></i>
          <span>Tracker</span>
        </button>
        
        <button 
          className={`nav-item ${activeTab === 'profile' ? 'active' : ''}`}
          onClick={() => setActiveTab('profile')}
        >
          <i className="fas fa-user"></i>
          <span>Profile</span>
        </button>
        
        <button 
          className={`nav-item ${activeTab === 'chat' ? 'active' : ''}`}
          onClick={() => setActiveTab('chat')}
        >
          <i className="fas fa-comment-medical"></i>
          <span>Assistant</span>
        </button>
      </nav>
    </div>
  );
}

// Home Dashboard Component
function HomeDashboard({ healthData, reminders, toggleReminder, patientData }) {
  return (
    <div className="dashboard">
      <h2>Health Dashboard</h2>
      
      <div className="health-overview">
        <div className="health-card">
          <h3>Blood Pressure</h3>
          <div className="health-value">
            {healthData.bloodPressure.systolic}/{healthData.bloodPressure.diastolic} mmHg
          </div>
          <div className={`health-status ${healthData.bloodPressure.systolic > 130 ? 'warning' : 'normal'}`}>
            {healthData.bloodPressure.systolic > 130 ? 'Slightly Elevated' : 'Normal'}
          </div>
        </div>
        
        <div className="health-card">
          <h3>Blood Sugar</h3>
          <div className="health-value">
            Fasting: {healthData.bloodSugar.fasting} mg/dL
          </div>
          <div className={`health-status ${healthData.bloodSugar.fasting > 100 ? 'warning' : 'normal'}`}>
            {healthData.bloodSugar.fasting > 100 ? 'Monitor Closely' : 'Normal'}
          </div>
        </div>
        
        <div className="health-card">
          <h3>Weight</h3>
          <div className="health-value">
            {healthData.weight} kg
          </div>
          <div className="health-status normal">
            Stable
          </div>
        </div>
      </div>
      
      <div className="dashboard-section">
        <h3>Today's Reminders</h3>
        <div className="reminders-list">
          {reminders.map(reminder => (
            <div key={reminder.id} className="reminder-item">
              <div className="reminder-checkbox">
                <input 
                  type="checkbox" 
                  checked={reminder.completed}
                  onChange={() => toggleReminder(reminder.id)}
                />
              </div>
              <div className="reminder-details">
                <span className={`reminder-title ${reminder.completed ? 'completed' : ''}`}>
                  {reminder.title}
                </span>
                <span className="reminder-time">{reminder.time}</span>
              </div>
            </div>
          ))}
        </div>
      </div>
      
      <div className="dashboard-section">
        <h3>Your Conditions</h3>
        <div className="conditions-list">
          {patientData.conditions.map((condition, index) => (
            <div key={index} className="condition-tag">
              {condition}
            </div>
          ))}
        </div>
      </div>
    </div>
  );
}

// Reports Section Component
function ReportsSection({ reports, handleFileUpload }) {
  return (
    <div className="reports-section">
      <h2>Medical Reports</h2>
      
      <div className="upload-section">
        <h3>Upload New Report</h3>
        <div className="upload-card">
          <div className="upload-icon">
            <i className="fas fa-cloud-upload-alt"></i>
          </div>
          <p>Upload your lab reports in PDF, JPG, or PNG format</p>
          <label htmlFor="file-upload" className="upload-button">
            Choose File
          </label>
          <input 
            id="file-upload"
            type="file" 
            accept=".pdf,.jpg,.jpeg,.png" 
            onChange={handleFileUpload}
            style={{ display: 'none' }}
          />
        </div>
      </div>
      
      <div className="reports-list">
        <h3>Recent Reports</h3>
        {reports.map(report => (
          <div key={report.id} className="report-card">
            <div className="report-icon">
              <i className={`fas fa-file-${report.fileType.toLowerCase()}`}></i>
            </div>
            <div className="report-details">
              <h4>{report.name}</h4>
              <p>Date: {report.date} | Type: {report.type}</p>
            </div>
            <div className="report-actions">
              <button className="action-btn view-btn">
                <i className="fas fa-eye"></i>
              </button>
              <button className="action-btn download-btn">
                <i className="fas fa-download"></i>
              </button>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}

// Disease Tracker Component
function DiseaseTracker({ selectedDisease, setSelectedDisease }) {
  const diseases = [
    { id: 'diabetes', name: 'Diabetes', icon: 'fas fa-syringe' },
    { id: 'hypertension', name: 'Hypertension', icon: 'fas fa-heartbeat' },
    { id: 'asthma', name: 'Asthma/COPD', icon: 'fas fa-lungs' },
    { id: 'thyroid', name: 'Thyroid', icon: 'fas fa-brain' },
    { id: 'arthritis', name: 'Arthritis', icon: 'fas fa-bone' }
  ];

  return (
    <div className="disease-tracker">
      <h2>Disease Management</h2>
      
      <div className="disease-selector">
        {diseases.map(disease => (
          <button
            key={disease.id}
            className={`disease-option ${selectedDisease === disease.id ? 'active' : ''}`}
            onClick={() => setSelectedDisease(disease.id)}
          >
            <i className={disease.icon}></i>
            <span>{disease.name}</span>
          </button>
        ))}
      </div>
      
      <div className="tracker-content">
        {selectedDisease === 'diabetes' && <DiabetesTracker />}
        {selectedDisease === 'hypertension' && <HypertensionTracker />}
        {selectedDisease === 'asthma' && <AsthmaTracker />}
        {selectedDisease === 'thyroid' && <ThyroidTracker />}
        {selectedDisease === 'arthritis' && <ArthritisTracker />}
      </div>
    </div>
  );
}

// Individual Disease Trackers (simplified for demo)
function DiabetesTracker() {
  const [sugarLevel, setSugarLevel] = useState('');
  const [insulinDose, setInsulinDose] = useState('');
  
  return (
    <div className="tracker-form">
      <h3>Diabetes Tracking</h3>
      <div className="form-group">
        <label>Blood Sugar Level (mg/dL)</label>
        <input 
          type="number" 
          value={sugarLevel}
          onChange={(e) => setSugarLevel(e.target.value)}
          placeholder="Enter current sugar level"
        />
      </div>
      <div className="form-group">
        <label>Insulin Dose (units)</label>
        <input 
          type="number" 
          value={insulinDose}
          onChange={(e) => setInsulinDose(e.target.value)}
          placeholder="Enter insulin dose"
        />
      </div>
      <div className="form-group">
        <label>Meal Time</label>
        <select>
          <option>Fasting</option>
          <option>Before Breakfast</option>
          <option>After Breakfast</option>
          <option>Before Lunch</option>
          <option>After Lunch</option>
          <option>Before Dinner</option>
          <option>After Dinner</option>
        </select>
      </div>
      <button className="submit-btn">Log Entry</button>
    </div>
  );
}

function HypertensionTracker() {
  return (
    <div className="tracker-form">
      <h3>Hypertension Tracking</h3>
      <p>Track your blood pressure readings and medication.</p>
      {/* Similar form structure for hypertension */}
    </div>
  );
}

function AsthmaTracker() {
  return (
    <div className="tracker-form">
      <h3>Asthma/COPD Tracking</h3>
      <p>Monitor inhaler usage and air quality impact.</p>
      {/* Similar form structure for asthma */}
    </div>
  );
}

function ThyroidTracker() {
  return (
    <div className="tracker-form">
      <h3>Thyroid Management</h3>
      <p>Track TSH, T3, T4 levels and symptoms.</p>
      {/* Similar form structure for thyroid */}
    </div>
  );
}

function ArthritisTracker() {
  return (
    <div className="tracker-form">
      <h3>Arthritis Tracker</h3>
      <p>Monitor pain levels and mobility exercises.</p>
      {/* Similar form structure for arthritis */}
    </div>
  );
}

// Profile Section Component
function ProfileSection({ patientData, setPatientData }) {
  const [isEditing, setIsEditing] = useState(false);
  const [formData, setFormData] = useState(patientData);

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setFormData({ ...formData, [name]: value });
  };

  const handleSave = () => {
    setPatientData(formData);
    setIsEditing(false);
  };

  return (
    <div className="profile-section">
      <div className="profile-header">
        <h2>Patient Profile</h2>
        <button 
          className={`edit-btn ${isEditing ? 'save' : ''}`}
          onClick={isEditing ? handleSave : () => setIsEditing(true)}
        >
          {isEditing ? 'Save' : 'Edit'}
        </button>
      </div>
      
      <div className="profile-card">
        <div className="profile-image-section">
          <div className="profile-image">
            {patientData.profileImage ? (
              <img src={patientData.profileImage} alt="Profile" />
            ) : (
              <div className="avatar-placeholder large">
                {patientData.name.charAt(0)}
              </div>
            )}
          </div>
          {isEditing && (
            <button className="change-photo-btn">
              Change Photo
            </button>
          )}
        </div>
        
        <div className="profile-details">
          <div className="form-group">
            <label>Full Name</label>
            {isEditing ? (
              <input 
                type="text" 
                name="name"
                value={formData.name}
                onChange={handleInputChange}
              />
            ) : (
              <div className="profile-value">{patientData.name}</div>
            )}
          </div>
          
          <div className="form-row">
            <div className="form-group">
              <label>Age</label>
              {isEditing ? (
                <input 
                  type="number" 
                  name="age"
                  value={formData.age}
                  onChange={handleInputChange}
                />
              ) : (
                <div className="profile-value">{patientData.age}</div>
              )}
            </div>
            
            <div className="form-group">
              <label>Gender</label>
              {isEditing ? (
                <select name="gender" value={formData.gender} onChange={handleInputChange}>
                  <option value="Male">Male</option>
                  <option value="Female">Female</option>
                  <option value="Other">Other</option>
                </select>
              ) : (
                <div className="profile-value">{patientData.gender}</div>
              )}
            </div>
          </div>
          
          <div className="form-group">
            <label>Email</label>
            {isEditing ? (
              <input 
                type="email" 
                name="email"
                value={formData.email}
                onChange={handleInputChange}
              />
            ) : (
              <div className="profile-value">{patientData.email}</div>
            )}
          </div>
          
          <div className="form-group">
            <label>Phone</label>
            {isEditing ? (
              <input 
                type="tel" 
                name="phone"
                value={formData.phone}
                onChange={handleInputChange}
              />
            ) : (
              <div className="profile-value">{patientData.phone}</div>
            )}
          </div>
          
          <div className="form-group">
            <label>Address</label>
            {isEditing ? (
              <textarea 
                name="address"
                value={formData.address}
                onChange={handleInputChange}
                rows="2"
              />
            ) : (
              <div className="profile-value">{patientData.address}</div>
            )}
          </div>
          
          <div className="form-group">
            <label>Emergency Contact</label>
            {isEditing ? (
              <input 
                type="text" 
                name="emergencyContact"
                value={formData.emergencyContact}
                onChange={handleInputChange}
              />
            ) : (
              <div className="profile-value">{patientData.emergencyContact}</div>
            )}
          </div>
          
          <div className="form-group">
            <label>Medical Conditions</label>
            <div className="conditions-list">
              {patientData.conditions.map((condition, index) => (
                <div key={index} className="condition-tag">
                  {condition}
                </div>
              ))}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

// Chat Section Component
function ChatSection({ chatMessages, newMessage, setNewMessage, handleSendMessage }) {
  const chatContainerRef = React.useRef(null);

  useEffect(() => {
    // Scroll to bottom when new messages are added
    if (chatContainerRef.current) {
      chatContainerRef.current.scrollTop = chatContainerRef.current.scrollHeight;
    }
  }, [chatMessages]);

  return (
    <div className="chat-section">
      <div className="chat-header">
        <h2>Health Assistant</h2>
        <div className="chat-subtitle">Ask questions about your condition, medications, or lifestyle</div>
      </div>
      
      <div className="chat-messages" ref={chatContainerRef}>
        {chatMessages.map(message => (
          <div key={message.id} className={`message ${message.sender}`}>
            <div className="message-bubble">
              {message.text}
            </div>
          </div>
        ))}
      </div>
      
      <div className="chat-input">
        <input 
          type="text" 
          placeholder="Type your message here..."
          value={newMessage}
          onChange={(e) => setNewMessage(e.target.value)}
          onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()}
        />
        <button onClick={handleSendMessage}>
          <i className="fas fa-paper-plane"></i>
        </button>
      </div>
    </div>
  );
}

export default App;
